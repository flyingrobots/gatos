# GATOS API Interaction Model

<a id="gatos-api-interaction-model"></a>

<!-- AUTOGENERATED TOC START -->

- [Request/Response Flow](#request-response-flow)
- [Error Responses](#error-responses)

<!-- AUTOGENERATED TOC END -->

GATOS does not use a traditional RESTful API. Instead, it uses a JSONL (JSON Lines) RPC protocol for communication between clients (like SDKs or the CLI) and the `gatosd` daemon. Communication typically happens over `stdin`/`stdout` or a TCP socket.

This diagram illustrates the request/response flow for several key commands.

## Request/Response Flow

<a id="request-response-flow"></a>

```mermaid
sequenceDiagram
    participant Client as Client (SDK/CLI)
    participant Daemon as gatosd

    Client->>Daemon: {"type":"append_event", "id":"01A", "ns":"...", "event":{...}}
    Daemon-->>Client: {"ok":true, "id":"01A", "commit_id":"..."}

    Client->>Daemon: {"type":"bus.publish", "id":"01B", "topic":"...", "payload":{...}}
    Daemon-->>Client: {"ok":true, "id":"01B", "msg_id":"..."}

    Client->>Daemon: {"type":"bus.subscribe", "id":"01C", "topic":"..."}
    Daemon-->>Client: {"ack":true, "id":"01C"}
    loop Subscription Stream
        Daemon-->>Client: {"type":"bus.message", "id":"01C", "topic":"...", "payload":{...}}
    end

    Client->>Daemon: {"type":"fold_state", "id":"01D", "ns":"..."}
    Daemon-->>Client: {"ok":true, "id":"01D", "state_root":"..."}
```

## Error Responses

<a id="error-responses"></a>
All responses include an `ok` boolean. On failure, an `error` object is present:

```json
{"ok":false, "id":"02A", "error": {"code":"ERR_INVALID_NS", "message":"namespace not found"}}
```

Example flow with an error:

```mermaid
sequenceDiagram
    participant Client as Client (SDK/CLI)
    participant Daemon as gatosd

    Client->>Daemon: {"type":"append_event", "id":"02A", "ns":"invalid", "event":{...}}
    Daemon-->>Client: {"ok":false, "id":"02A", "error":{"code":"ERR_INVALID_NS", "message":"namespace not found"}}
```
