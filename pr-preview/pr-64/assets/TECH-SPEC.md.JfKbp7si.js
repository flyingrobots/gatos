import{_ as i,c as a,o as t,a3 as s}from"./chunks/framework.BXNB9gP7.js";const o="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_1.BR-5lHF6.svg",r="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_2.B7q4ImLL.svg",n="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_3.DYLz9Qas.svg",l="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_4.Ciczl0P6.svg",d="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_5.OxKhBRCd.svg",c="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_6.BHzAP7hQ.svg",h="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_7.BarzZtcp.svg",p="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_8.8JacjA7H.svg",g="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_9.BtEmixUs.svg",u="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_10.vJa0W527.svg",k="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_11.Bk8bW50j.svg",m="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_12.hkA2j6xO.svg",E="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_13.BEr3liFL.svg",f="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_14.C5i0gIvD.svg",y="/gatos/pr-preview/pr-64/assets/docs_TECH-SPEC__15850d53f4__mermaid_15.BXp80gwC.svg",x=JSON.parse('{"title":"GATOS — TECH-SPEC v0.3","description":"","frontmatter":{},"headers":[],"relativePath":"TECH-SPEC.md","filePath":"TECH-SPEC.md","lastUpdated":1763132207000}'),C={name:"TECH-SPEC.md"};function b(_,e,q,v,F,P){return t(),a("div",{"data-pagefind-body":!0},[...e[0]||(e[0]=[s('<h1 id="gatos-—-tech-spec-v0-3" tabindex="-1">GATOS — TECH-SPEC v0.3 <a class="header-anchor" href="#gatos-—-tech-spec-v0-3" aria-label="Permalink to &quot;GATOS — TECH-SPEC v0.3&quot;">​</a></h1><p><a id="gatos--tech-spec-v03"></a><a id="gatos-tech-spec-v0.3"></a></p><ul><li><a href="#implementation-plan-data-structures-and-algorithms">Implementation Plan, Data Structures, and Algorithms</a></li><li><a href="#1">1. Codebase Layout (Rust Workspace)</a><ul><li><a href="#reuse-refactor-recommendations">Reuse &amp; refactor recommendations</a></li></ul></li><li><a href="#2">2. Crate Architecture</a><ul><li><a href="#crate-summary">Crate Summary</a></li></ul></li><li><a href="#3">3. Fold Engine (Echo integration)</a><ul><li><a href="#echolua-compiler-vm">EchoLua Compiler &amp; VM</a><ul><li><a href="#engine-ids">Engine IDs</a></li></ul></li></ul></li><li><a href="#4">4. Index &amp; Cache</a></li><li><a href="#5">5. Epochs &amp; Compaction</a></li><li><a href="#6">6. Opaque Pointers</a></li><li><a href="#7">7. JSONL Protocol</a></li><li><a href="#8">8. Observability</a></li><li><a href="#9">9. CI &amp; Cross-Platform Determinism</a></li><li><a href="#10">10. Security</a></li><li><a href="#11">11. Performance Guidance</a></li><li><a href="#12">12. Client SDKs</a></li><li><a href="#13">13. Migration Strategies</a></li><li><a href="#14">14. Wire-Format Invariants</a></li><li><a href="#15">15. Compute Engine (Job Runner)</a><ul><li><a href="#implementation-plan">Implementation Plan</a></li><li><a href="#cli-surface-selected">CLI Surface (selected)</a></li></ul></li><li><a href="#16">16. Governance Engine</a><ul><li><a href="#engine-responsibilities">Engine Responsibilities</a></li><li><a href="#cli-skeleton-this-defines-the-normative-cli-user-interface-stub-behavior-acceptable-initially">CLI Skeleton (This defines the normative CLI user interface; stub behavior acceptable initially)</a></li><li><a href="#group-resolution">Group Resolution</a></li><li><a href="#revocation-propagation">Revocation Propagation</a></li><li><a href="#end-to-end-flow">End-to-End Flow</a></li></ul></li></ul><p><a id="gatos-tech-spec-v0.3"></a></p><h2 id="implementation-plan-data-structures-and-algorithms" tabindex="-1">Implementation Plan, Data Structures, and Algorithms <a class="header-anchor" href="#implementation-plan-data-structures-and-algorithms" aria-label="Permalink to &quot;Implementation Plan, Data Structures, and Algorithms&quot;">​</a></h2><p><a id="implementation-plan-data-structures-and-algorithms"></a></p><blockquote><p><em>This is how we GATOS.</em></p></blockquote><hr><h2 id="_1-codebase-layout-rust-workspace" tabindex="-1">1. Codebase Layout (Rust Workspace) <a class="header-anchor" href="#_1-codebase-layout-rust-workspace" aria-label="Permalink to &quot;1. Codebase Layout (Rust Workspace)&quot;">​</a></h2><p><a id="1-codebase-layout-rust-workspace"></a><a id="1.-codebase-layout-rust-workspace"></a> The GATOS workspace is organized into <code>crates</code> for core components and <code>bindings</code> for FFI.</p><figure><img src="'+o+'" alt="diagram 1" loading="lazy"></figure><h3 id="reuse-refactor-recommendations" tabindex="-1">Reuse &amp; refactor recommendations <a class="header-anchor" href="#reuse-refactor-recommendations" aria-label="Permalink to &quot;Reuse &amp; refactor recommendations&quot;">​</a></h3><p><a id="reuse--refactor-recommendations"></a><a id="reuse-refactor-recommendations"></a></p><ul><li>Reuse <strong>Echo</strong> crates for fold determinism (<code>rmg-core</code> as the fold engine).</li><li>Adopt <strong><code>git-kv</code></strong> “Stargate” concepts for optional <code>push-gate</code> profile.</li><li>Integrate <strong>Wesley</strong> as a compiler target to emit schemas and fold specs.</li></ul><hr><h2 id="_2-crate-architecture" tabindex="-1">2. Crate Architecture <a class="header-anchor" href="#_2-crate-architecture" aria-label="Permalink to &quot;2. Crate Architecture&quot;">​</a></h2><p><a id="2-crate-architecture"></a><a id="2.-crate-architecture"></a> GATOS follows a &quot;Ports and Adapters&quot; architecture. The core logic is pure and portable (<code>no_std</code>), while I/O is handled by specific &quot;adapters.&quot;</p><figure><img src="'+r+'" alt="diagram 2" loading="lazy"></figure><p>Note: “Policy/Trust Plane” includes the policy engine and trust artifacts (keys, groups, grants, revocations) governed alongside policies.</p><h3 id="crate-summary" tabindex="-1">Crate Summary <a class="header-anchor" href="#crate-summary" aria-label="Permalink to &quot;Crate Summary&quot;">​</a></h3><p><a id="crate-summary"></a></p><table tabindex="0"><thead><tr><th style="text-align:left;">Crate</th><th style="text-align:left;">Purpose</th></tr></thead><tbody><tr><td style="text-align:left;"><code>gatos-ledger-core</code></td><td style="text-align:left;"><code>no_std</code> core logic, data structures, and traits for the ledger.</td></tr><tr><td style="text-align:left;"><code>gatos-ledger-git</code></td><td style="text-align:left;"><code>std</code>-dependent storage backend using <code>libgit2</code>.</td></tr><tr><td style="text-align:left;"><code>gatos-ledger</code></td><td style="text-align:left;">Composes ledger components via feature flags.</td></tr><tr><td style="text-align:left;"><code>gatos-mind</code></td><td style="text-align:left;">Asynchronous, commit-backed message bus (pub/sub).</td></tr><tr><td style="text-align:left;"><code>gatos-echo</code></td><td style="text-align:left;">Deterministic state engine for processing events (&quot;folds&quot;).</td></tr><tr><td style="text-align:left;"><code>gatos-policy</code></td><td style="text-align:left;">Deterministic policy engine for executing compiled rules and managing the Consensus Governance lifecycle.</td></tr><tr><td style="text-align:left;"><code>gatos-kv</code></td><td style="text-align:left;">Git-backed key-value state cache.</td></tr><tr><td style="text-align:left;"><code>gatosd</code></td><td style="text-align:left;">Main binary for the CLI and the JSONL RPC daemon.</td></tr><tr><td style="text-align:left;"><code>gatos-compute</code></td><td style="text-align:left;">Worker that discovers and executes jobs from the Job Plane.</td></tr><tr><td style="text-align:left;"><code>gatos-wasm-bindings</code></td><td style="text-align:left;">WASM bindings for browser and Node.js environments.</td></tr><tr><td style="text-align:left;"><code>gatos-ffi-bindings</code></td><td style="text-align:left;">C-compatible FFI for integration with other languages.</td></tr></tbody></table><hr><h2 id="_3-fold-engine-echo-integration" tabindex="-1">3. Fold Engine (Echo integration) <a class="header-anchor" href="#_3-fold-engine-echo-integration" aria-label="Permalink to &quot;3. Fold Engine (Echo integration)&quot;">​</a></h2><p><a id="3-fold-engine-echo-integration"></a><a id="3.-fold-engine-echo-integration"></a> Note on policy rule naming</p><ul><li>Governance actions are referenced as <code>governance.&lt;action&gt;</code>; <code>action</code> tokens use dot-notation (e.g., <code>publish.artifact</code>). Policy evaluation resolves these against the governance policy map defined in <code>schemas/v1/policy/governance_policy.schema.json</code>.</li></ul><p>The Fold Engine consumes canonicalized events to produce a canonical state tree.</p><figure><img src="'+n+'" alt="diagram 3" loading="lazy"></figure><p>See also:</p><ul><li>Checkpoint trailers (normative) in SPEC: <a href="/gatos/pr-preview/pr-64/SPEC.html#53-state-checkpoint-trailers-normative">State Checkpoint Trailers</a></li><li>Walkthrough: <a href="./guide/HELLO-OPS.html#2-fold-to-state-and-inspect">HELLO-OPS</a></li></ul><h3 id="echolua-compiler-vm" tabindex="-1">EchoLua Compiler &amp; VM <a class="header-anchor" href="#echolua-compiler-vm" aria-label="Permalink to &quot;EchoLua Compiler &amp; VM&quot;">​</a></h3><p><a id="echolua-compiler--vm"></a><a id="echolua-compiler-vm"></a><a id="echolua"></a> EchoLua provides deterministic folds and policy evaluation:</p><ul><li>Compiler: Lua source → normalized AST → Echo Lua IR (ELC); ELC serialized as DAG-CBOR; <code>fold_root = sha256(ELC_bytes)</code>.</li><li>Runtime: Q32.32 fixed-point math; division rounds toward zero; canonical JSON emission; no OS/RNG/time; no coroutines/FFI; no transcendentals in v1 folds.</li><li>Stdlib: <code>dpairs</code>, <code>dkeys</code>, <code>dsort</code>, <code>encode_canonical</code>, <code>decode_strict</code>.</li><li>RNG: <code>rng(seed_bytes)</code> only; no ambient global state. Normative algorithm: <code>pcg32@1</code>. Canonical seed helper: <code>seed64 = trunc64(blake3(inputs_root || policy_root || fold_root))</code>.</li><li>Linter: fail on <code>pairs</code>, <code>coroutine</code>, <code>__gc</code>, <code>__pairs</code>, <code>math.random</code>, <code>os.*</code>, <code>io.*</code>, <code>debug.*</code>, <code>package.*</code>.</li><li>Fuel/step limits to guarantee termination.</li></ul><p>Artifacts:</p><ul><li>Record <code>Fold-Root: sha256:&lt;hex&gt;</code> in state trailers ([[[[[[<a href="/gatos/pr-preview/pr-64/SPEC.html#5.3">SPEC §5.3</a>](/SPEC#5.3)](/SPEC#5.3)](/SPEC#5.3)](/SPEC#5.3)](/SPEC#5.3)](/SPEC#5.3)) and PoF ([[[[[[<a href="/gatos/pr-preview/pr-64/SPEC.html#5.4">SPEC §5.4</a>](/SPEC#5.4)](/SPEC#5.4)](/SPEC#5.4)](/SPEC#5.4)](/SPEC#5.4)](/SPEC#5.4)).</li><li>Record <code>Fold-Engine: echo@&lt;semver&gt;+elc@&lt;semver&gt;+num=q32.32+rng=pcg32@&lt;ver&gt;</code>.</li></ul><h4 id="engine-ids" tabindex="-1">Engine IDs <a class="header-anchor" href="#engine-ids" aria-label="Permalink to &quot;Engine IDs&quot;">​</a></h4><p><a id="engine-ids"></a> Fold engine identity is a structured string used in trailers and proofs:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>echo@&lt;semver&gt;+elc@&lt;semver&gt;+num=q32.32+rng=pcg32@&lt;ver&gt;</span></span></code></pre></div><p>This binds runtime, IR version, numeric model, and RNG configuration for reproducible verification.</p><p>Testing:</p><ul><li>Golden vectors across linux/macos/windows/wasm; integer and fixed-point cases; poison tests for NaNs/signed zero/table iteration.</li></ul><hr><h2 id="_4-index-cache" tabindex="-1">4. Index &amp; Cache <a class="header-anchor" href="#_4-index-cache" aria-label="Permalink to &quot;4. Index &amp; Cache&quot;">​</a></h2><p><a id="4-index--cache"></a><a id="4.-index-cache"></a> Rebuildable indexes are created by folding journal events into Roaring Bitmaps.</p><figure><img src="'+l+'" alt="diagram 4" loading="lazy"></figure><hr><h2 id="_5-epochs-compaction" tabindex="-1">5. Epochs &amp; Compaction <a class="header-anchor" href="#_5-epochs-compaction" aria-label="Permalink to &quot;5. Epochs &amp; Compaction&quot;">​</a></h2><p><a id="5-epochs--compaction"></a><a id="5.-epochs-compaction"></a> Epochs manage history size by creating periodic anchors and enabling garbage collection.</p><figure><img src="'+d+'" alt="diagram 5" loading="lazy"></figure><hr><h2 id="_6-opaque-pointers" tabindex="-1">6. Opaque Pointers <a class="header-anchor" href="#_6-opaque-pointers" aria-label="Permalink to &quot;6. Opaque Pointers&quot;">​</a></h2><p><a id="6-opaque-pointers"></a><a id="6.-opaque-pointers"></a> The <code>rekey</code> command allows updating the encryption key for an opaque blob.</p><figure><img src="'+c+'" alt="diagram 6" loading="lazy"></figure><p>Resolver authentication (normative default): Bearer JWT. Required claims: <code>sub</code>, <code>aud</code>, <code>exp</code>; optional <code>scope</code>. Decisions and fetches SHOULD be logged under <code>refs/gatos/audit/</code>.</p><hr><h2 id="_7-jsonl-protocol" tabindex="-1">7. JSONL Protocol <a class="header-anchor" href="#_7-jsonl-protocol" aria-label="Permalink to &quot;7. JSONL Protocol&quot;">​</a></h2><p><a id="7-jsonl-protocol"></a><a id="7.-jsonl-protocol"></a> Communication with <code>gatosd</code> occurs over a JSONL RPC protocol. Long-running operations MUST quickly return an <code>{ &quot;ack&quot;: true }</code> and stream progress lines keyed by id.</p><figure><img src="'+h+'" alt="diagram 7" loading="lazy"></figure><p>Error frames are normalized:</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{ </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;ok&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;01C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;code&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;ERR_INVALID_NS&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;reason&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;namespace not found&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span></code></pre></div><p>Walkthroughs</p><ul><li>Append → Fold → Job result (PoE): <a href="./guide/HELLO-OPS.html">HELLO-OPS</a></li><li>Opaque pointers and rekey: <a href="./guide/HELLO-PRIVACY.html">HELLO-PRIVACY</a></li></ul><hr><h2 id="_8-observability" tabindex="-1">8. Observability <a class="header-anchor" href="#_8-observability" aria-label="Permalink to &quot;8. Observability&quot;">​</a></h2><p><a id="8-observability"></a><a id="8.-observability"></a><code>gatosd</code> exposes key performance metrics for monitoring.</p><figure><img src="'+p+'" alt="diagram 8" loading="lazy"></figure><hr><h2 id="_9-ci-cross-platform-determinism" tabindex="-1">9. CI &amp; Cross-Platform Determinism <a class="header-anchor" href="#_9-ci-cross-platform-determinism" aria-label="Permalink to &quot;9. CI &amp; Cross-Platform Determinism&quot;">​</a></h2><p><a id="9-ci--cross-platform-determinism"></a><a id="9.-ci-cross-platform-determinism"></a><a id="9.-ci-crossplatform-determinism"></a> A CI matrix ensures determinism across platforms and runs specialized test suites.</p><figure><img src="'+g+'" alt="diagram 9" loading="lazy"></figure><hr><h2 id="_10-security" tabindex="-1">10. Security <a class="header-anchor" href="#_10-security" aria-label="Permalink to &quot;10. Security&quot;">​</a></h2><p><a id="10-security"></a><a id="10.-security"></a> Signature verification is a critical step in event processing.</p><figure><img src="'+u+`" alt="diagram 10" loading="lazy"></figure><p>Examples</p><div class="language-json vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;append_event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;01A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;ns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;finance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;event&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:{}}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;bus.subscribe&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;01C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;topic&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gatos.jobs.pending&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;fold_state&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;01D&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;ns&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;finance&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;channel&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;table&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;spec&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;folds/invoices.yaml&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;governance.proposal.new&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;02A&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;action&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;publish.artifact&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;target&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;gatos://assets/model.bin&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;quorum&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2-of-3@leads&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;governance.approval.add&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;02B&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;proposal&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;proposal-id-hash&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;type&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;governance.grant.verify&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;id&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;02C&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;grant&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;&lt;grant-id-hash&gt;&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><hr><h2 id="_11-performance-guidance" tabindex="-1">11. Performance Guidance <a class="header-anchor" href="#_11-performance-guidance" aria-label="Permalink to &quot;11.  Performance Guidance&quot;">​</a></h2><p><a id="11--performance-guidance"></a><a id="11.-performance-guidance"></a> Tuning batch size is a trade-off between latency and commit churn.</p><figure><img src="`+k+'" alt="diagram 11" loading="lazy"></figure><hr><h2 id="_12-client-sdks" tabindex="-1">12. Client SDKs <a class="header-anchor" href="#_12-client-sdks" aria-label="Permalink to &quot;12. Client SDKs&quot;">​</a></h2><p><a id="12-client-sdks"></a><a id="12.-client-sdks"></a> SDKs provide language-native access to the <code>gatosd</code> JSONL RPC endpoint.</p><figure><img src="'+m+'" alt="diagram 12" loading="lazy"></figure><hr><h2 id="_13-migration-strategies" tabindex="-1">13. Migration Strategies <a class="header-anchor" href="#_13-migration-strategies" aria-label="Permalink to &quot;13. Migration Strategies&quot;">​</a></h2><p><a id="13-migration-strategies"></a><a id="13.-migration-strategies"></a> A phased migration ensures a safe transition to GATOS.</p><figure><img src="'+E+'" alt="diagram 13" loading="lazy"></figure><hr><h2 id="_14-wire-format-invariants" tabindex="-1">14. Wire-Format Invariants <a class="header-anchor" href="#_14-wire-format-invariants" aria-label="Permalink to &quot;14. Wire-Format Invariants&quot;">​</a></h2><p><a id="14-wire-format-invariants"></a><a id="14.-wire-format-invariants"></a> To ensure hash stability, GATOS uses canonical encodings:</p><ul><li>Events/proofs: DAG-CBOR (CIDv1 with BLAKE3 bytes).</li><li>JSON artifacts (pointers, manifests): RFC 8785 JCS (UTF-8 NFC; sorted keys; fixed numeric formatting).</li><li>Fold engine identity: <code>Fold-Engine: echo@&lt;semver&gt;+elc@&lt;semver&gt;+num=q32.32+rng=pcg32@&lt;ver&gt;</code>.</li><li>Explorer-Root (derived exports): <code>blake3(ledger_head || policy_root || state_root || extractor_version)</code>.</li></ul><hr><h2 id="_15-compute-engine-job-runner" tabindex="-1">15. Compute Engine (Job Runner) <a class="header-anchor" href="#_15-compute-engine-job-runner" aria-label="Permalink to &quot;15. Compute Engine (Job Runner)&quot;">​</a></h2><p><a id="15-compute-engine-job-runner"></a><a id="15.-compute-engine-job-runner"></a> See also: <a href="./decisions/ADR-0002/DECISION.html">ADR-0002</a>.</p><p>The <code>gatos-compute</code> crate provides the GATOS worker process.</p><figure><img src="'+f+'" alt="diagram 14" loading="lazy"></figure><h3 id="implementation-plan" tabindex="-1">Implementation Plan <a class="header-anchor" href="#implementation-plan" aria-label="Permalink to &quot;Implementation Plan&quot;">​</a></h3><p><a id="implementation-plan"></a></p><ol><li><strong>Subscription:</strong> The worker will use <code>gatos-mind</code> to subscribe to job topics.</li><li><strong>Claiming:</strong> The worker will use <code>gatos-ledger</code> to atomically claim a job via compare-and-swap on a single lock ref <code>refs/gatos/jobs/&lt;job-id&gt;/claim</code>.</li><li><strong>Execution:</strong> The worker will execute the job&#39;s <code>command</code> in a sandboxed environment.</li><li><strong>Result &amp; Proof:</strong> The worker will create a <code>Result</code> commit containing output artifacts and a <code>Proof-Of-Execution</code>.</li><li><strong>Lifecycle Management:</strong> The worker will handle timeouts, retries, and failures.</li></ol><h3 id="cli-surface-selected" tabindex="-1">CLI Surface (selected) <a class="header-anchor" href="#cli-surface-selected" aria-label="Permalink to &quot;CLI Surface (selected)&quot;">​</a></h3><p><a id="cli-surface-selected"></a></p><ul><li><code>git gatos foldc &lt;src.lua&gt; -o &lt;out.elc&gt;</code> — compile EchoLua → ELC; prints fold_root; records engine id.</li><li><code>git gatos policyc &lt;src.rgs&gt; -o &lt;out.rgc&gt;</code> — compile .rgs → rgc/ELC; prints policy_code_root.</li><li><code>git gatos export parquet|sqlite --state &lt;ref&gt; --out &lt;dir&gt;</code>; <code>git gatos export verify &lt;dir&gt;</code> — Explorer-Root verify.</li><li><code>git gatos pox create|verify</code> and <code>git gatos reproduce &lt;id&gt;</code> — Proof-of-Experiment workflow.</li><li><code>git gatos lint &lt;paths&gt;</code> — lints EchoLua sources for deterministic profile.</li></ul><hr><h2 id="_16-governance-engine" tabindex="-1">16. Governance Engine <a class="header-anchor" href="#_16-governance-engine" aria-label="Permalink to &quot;16. Governance Engine&quot;">​</a></h2><p><a id="16-governance-engine"></a><a id="16.-governance-engine"></a> See also: <a href="./decisions/ADR-0003/DECISION.html">ADR-0003</a>.</p><h3 id="engine-responsibilities" tabindex="-1">Engine Responsibilities <a class="header-anchor" href="#engine-responsibilities" aria-label="Permalink to &quot;Engine Responsibilities&quot;">​</a></h3><p><a id="engine-responsibilities"></a></p><ul><li>Watchers: a service in <code>gatos-policy</code> watches <code>refs/gatos/proposals/**</code> and <code>refs/gatos/approvals/**</code>.</li><li>Verification: for each new Approval, verify signature and eligibility using the trust graph.</li><li>Quorum check: evaluate the policy rule (<code>governance.&lt;action&gt;</code>) to determine if quorum is satisfied.</li><li>Grant creation: when quorum is met, create a Grant commit with a canonical Proof-Of-Consensus envelope and update <code>refs/gatos/grants/...</code>.</li><li>Gate enforcement: the Policy Gate checks for a valid Grant before allowing any governed action.</li></ul><h3 id="cli-skeleton-this-defines-the-normative-cli-user-interface-stub-behavior-acceptable-initially" tabindex="-1">CLI Skeleton (This defines the normative CLI user interface; stub behavior acceptable initially) <a class="header-anchor" href="#cli-skeleton-this-defines-the-normative-cli-user-interface-stub-behavior-acceptable-initially" aria-label="Permalink to &quot;CLI Skeleton (This defines the normative CLI user interface; stub behavior acceptable initially)&quot;">​</a></h3><p><a id="cli-skeleton-this-defines-the-normative-cli-user-interface-stub-behavior-acceptable-initially"></a></p><ul><li><code>gatos proposal new --action &lt;id&gt; --target &lt;uri&gt; --quorum &lt;expr&gt; [--ttl &lt;dur&gt;]</code></li><li><code>gatos approve --proposal &lt;blake3:…&gt; [--expires-at &lt;ts&gt;]</code></li><li><code>gatos grant verify --grant &lt;blake3:…&gt;</code></li></ul><h3 id="group-resolution" tabindex="-1">Group Resolution <a class="header-anchor" href="#group-resolution" aria-label="Permalink to &quot;Group Resolution&quot;">​</a></h3><p><a id="group-resolution"></a> Governance evaluator MUST resolve groups declared in policy (e.g., <code>group: leads</code>) against <code>gatos/trust/graph.json</code>.</p><h3 id="revocation-propagation" tabindex="-1">Revocation Propagation <a class="header-anchor" href="#revocation-propagation" aria-label="Permalink to &quot;Revocation Propagation&quot;">​</a></h3><p><a id="revocation-propagation"></a> Revocations MUST be surfaced to dependent systems (e.g., Job Plane). Implementations SHOULD emit <code>gatos.policy.grant.revoked</code> and deny actions gated by revoked grants.</p><h3 id="end-to-end-flow" tabindex="-1">End-to-End Flow <a class="header-anchor" href="#end-to-end-flow" aria-label="Permalink to &quot;End-to-End Flow&quot;">​</a></h3><p><a id="end-to-end-flow"></a><a id="endtoend-flow"></a></p><figure><img src="'+y+'" alt="diagram 15" loading="lazy"></figure>',119)])])}const w=i(C,[["render",b]]);export{x as __pageData,w as default};
