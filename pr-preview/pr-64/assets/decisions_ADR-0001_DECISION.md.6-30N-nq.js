import{_ as s,c as a,o as e,a3 as t}from"./chunks/framework.BXNB9gP7.js";const n="/gatos/pr-preview/pr-64/assets/docs_decisions_ADR-0001_DECISION__b1ba19490c__mermaid_1.CTiyxSeF.svg",o="/gatos/pr-preview/pr-64/assets/docs_decisions_ADR-0001_DECISION__b1ba19490c__mermaid_2.DxqWTlSV.svg",l="/gatos/pr-preview/pr-64/assets/docs_decisions_ADR-0001_DECISION__b1ba19490c__mermaid_3.Dq7bdOdU.svg",u=JSON.parse('{"title":"ADR-0001: Split gatos-ledger into no_std Core and std Backends","description":"","frontmatter":{"Status":"Accepted","Date":"2025-11-08T00:00:00.000Z"},"headers":[],"relativePath":"decisions/ADR-0001/DECISION.md","filePath":"decisions/ADR-0001/DECISION.md","lastUpdated":1763133914000}'),d={name:"decisions/ADR-0001/DECISION.md"};function r(h,i,p,c,k,g){return e(),a("div",{"data-pagefind-body":!0},[...i[0]||(i[0]=[t('<h1 id="adr-0001-split-gatos-ledger-into-no-std-core-and-std-backends" tabindex="-1">ADR-0001: Split gatos-ledger into <code>no_std</code> Core and <code>std</code> Backends <a class="header-anchor" href="#adr-0001-split-gatos-ledger-into-no-std-core-and-std-backends" aria-label="Permalink to &quot;ADR-0001: Split gatos-ledger into `no_std` Core and `std` Backends&quot;">​</a></h1><p><a id="adr-0001-split-gatos-ledger-into-no_std-core-and-std-backends"></a></p><ul><li><a href="#decision">Decision</a></li><li><a href="#motivation">Motivation</a></li><li><a href="#rationale">Rationale</a></li><li><a href="#consequences">Consequences</a><ul><li><a href="#usage-example">Usage Example</a></li></ul></li><li><a href="#opinions">Opinions</a></li></ul><p><a id="adr-0001-split-gatos-ledger-into-no_std-core-and-std-backends"></a></p><h2 id="decision" tabindex="-1">Decision <a class="header-anchor" href="#decision" aria-label="Permalink to &quot;Decision&quot;">​</a></h2><p><a id="decision"></a> The <code>gatos-ledger</code> crate will be split into a <code>no_std</code>-compatible <code>gatos-ledger-core</code> and one or more <code>std</code>-dependent storage backends (e.g., <code>gatos-ledger-git</code>).</p><p>A meta-crate, <code>gatos-ledger</code>, will use feature flags to provide the appropriate implementation.</p><p>Additionally, the canonical commit identifier (content id) SHALL be derived from the canonical serialization of the unsigned <code>CommitCore</code> and SHALL remain stable regardless of any signatures added later. Signatures are stored separately (or alongside as metadata) and reference this content id; they do not affect it.</p><h2 id="motivation" tabindex="-1">Motivation <a class="header-anchor" href="#motivation" aria-label="Permalink to &quot;Motivation&quot;">​</a></h2><p><a id="motivation"></a> The project requires <code>no_std</code> compatibility where practical, to allow the core logic to run in constrained environments like microcontrollers or WASM sandboxes.</p><p>The original <code>gatos-ledger</code> crate&#39;s dependency on <code>git2</code> (which requires <code>std</code>) was in direct conflict with this goal.</p><h2 id="rationale" tabindex="-1">Rationale <a class="header-anchor" href="#rationale" aria-label="Permalink to &quot;Rationale&quot;">​</a></h2><p><a id="rationale"></a> This &quot;<code>no_std</code> at the core, <code>std</code> at the edges&quot; architecture resolves the conflict by decoupling the pure, portable ledger semantics (commit graph, hashing, proofs) from the I/O-heavy storage layer. This structure is illustrated below:</p><figure><img src="'+n+`" alt="diagram 1" loading="lazy"></figure><p>The <code>gatos-ledger-core</code> crate contains only the portable logic, while backends like <code>gatos-ledger-git</code> implement a common <code>ObjectStore</code> trait for specific environments.</p><div class="language-rust vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">rust</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">pub</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> trait</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> ObjectStore</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> put_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;mut</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, data</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">u8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;(), </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StoreError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    fn</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> get_object</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">&amp;</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">self</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, id</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">:</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> &amp;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Hash</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">-&gt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> Result</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Option</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">Vec</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&lt;</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">u8</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;&gt;, </span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">StoreError</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">&gt;;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><p>This separation of concerns is demonstrated in the data flow for creating and persisting a commit:</p><figure><img src="`+o+`" alt="diagram 2" loading="lazy"></figure><p>This approach provides maximum portability and a lower attack surface for the core logic, without sacrificing the ability to use standard Git tooling on host systems.</p><h2 id="consequences" tabindex="-1">Consequences <a class="header-anchor" href="#consequences" aria-label="Permalink to &quot;Consequences&quot;">​</a></h2><p><a id="consequences"></a></p><ul><li>Core logic must remain <code>no_std</code> and avoid heap allocation unless gated by <code>alloc</code>.</li><li>The <code>gatos-ledger</code> meta-crate becomes the public-facing entry point, simplifying dependency management. Consumers select their desired backend via feature flags.</li><li>CI matrix must test both <code>core-only</code> and <code>git2-backend</code> builds.</li></ul><h3 id="usage-example" tabindex="-1">Usage Example <a class="header-anchor" href="#usage-example" aria-label="Permalink to &quot;Usage Example&quot;">​</a></h3><p><a id="usage-example"></a> A <code>std</code>-aware crate would depend on <code>gatos-ledger</code> like this:</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gatos-ledger = { version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, features = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;git2-backend&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] }</span></span></code></pre></div><p>A <code>no_std</code> crate would disable default features to use only the core logic:</p><div class="language-toml vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">toml</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">[</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">dependencies</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">gatos-ledger = { version = </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;0.1&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, default-features = </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">false</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, features = [</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;core-only&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">] }</span></span></code></pre></div><p>The way Cargo uses these feature flags to include the correct components at compile time is shown below:</p><figure><img src="`+l+'" alt="diagram 3" loading="lazy"></figure><h2 id="opinions" tabindex="-1">Opinions <a class="header-anchor" href="#opinions" aria-label="Permalink to &quot;Opinions&quot;">​</a></h2><p><a id="opinions"></a></p><ul><li><a href="./flyingrobots.html">flyingrobots</a></li></ul>',32)])])}const m=s(d,[["render",r]]);export{u as __pageData,m as default};
