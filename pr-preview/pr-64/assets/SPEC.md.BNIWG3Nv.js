import{_ as a,c as o,o as t,a3 as i}from"./chunks/framework.BXNB9gP7.js";const s="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_1.CHSMpKum.svg",r="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_2.l1rqk-X0.svg",n="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_3.Bek21FK4.svg",l="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_4.DQ_zYjga.svg",d="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_5.PCRy-933.svg",c="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_6.CSt0UMVO.svg",p="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_7.BVQtqfa1.svg",g="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_8.nOwM7A7e.svg",u="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_9.CFebyR87.svg",h="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_10.BudHllDJ.svg",m="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_11.DfT2hPZ7.svg",f="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_12.Bk35JoYA.svg",b="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_13.B0AxozPJ.svg",v="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_14.CwQMsLdd.svg",y="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_15.Bpvy6tWI.svg",_="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_16.CSVzMRzO.svg",k="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_17.BJUv_xQs.svg",x="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_18.D1X4NcR_.svg",P="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_19.6wlltvc7.svg",S="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_20.3Q8RmYGz.svg",C="/gatos/pr-preview/pr-64/assets/docs_SPEC__0679d036ea__mermaid_21.FdUSZu5I.svg",L=JSON.parse('{"title":"GATOS — SPEC v0.3 (Draft)","description":"","frontmatter":{},"headers":[],"relativePath":"SPEC.md","filePath":"SPEC.md","lastUpdated":1763124627000}'),q={name:"SPEC.md"};function w(T,e,E,A,M,O){return t(),o("div",{"data-pagefind-body":!0},[...e[0]||(e[0]=[i('<h1 id="gatos-—-spec-v0-3-draft" tabindex="-1">GATOS — SPEC v0.3 (Draft) <a class="header-anchor" href="#gatos-—-spec-v0-3-draft" aria-label="Permalink to &quot;GATOS — SPEC v0.3 (Draft)&quot;">​</a></h1><p><a id="gatos--spec-v03-draft"></a></p><p><a id="gatos--spec-v03-draft"></a><a id="gatos-spec-v0.3-draft"></a></p><ul><li><a href="#git-as-the-operating-surface">Git As The Operating Surface</a></li><li><a href="#0">0. Conventions</a></li><li><a href="#1">1. System Model</a><ul><li><a href="#requirements">Requirements</a></li></ul></li><li><a href="#2">2. On-Disk Layout (Normative)</a></li><li><a href="#3">3. Identities, Actors, and Grants</a><ul><li><a href="#3.1">3.1 Actors</a></li><li><a href="#3.2">3.2 Capability Grants</a></li></ul></li><li><a href="#4">4. Events (Ledger Plane)</a><ul><li><a href="#4.1">4.1 Event Envelope</a></li><li><a href="#4.2">4.2 Journal Semantics</a></li></ul></li><li><a href="#5">5. State (Deterministic Folds)</a><ul><li><a href="#5.1">5.1 Fold Function</a></li><li><a href="#5.2">5.2 Fold Spec &amp; Checkpoints</a></li><li><a href="#5.3">5.3 State Checkpoint Trailers (Normative)</a></li><li><a href="#5.4">5.4 Proof-of-Fold (PoF)</a></li></ul></li><li><a href="#6">6. Policy &amp; Decision Audit</a><ul><li><a href="#6.1">6.1 Gate Contract</a></li></ul></li><li><a href="#7">7. Blob Pointers &amp; Opaque Storage (Hybrid Privacy)</a></li><li><a href="#8">8. Message Bus (Commit-Backed Pub/Sub)</a></li><li><a href="#9">9. Sessions (Working Branches)</a></li><li><a href="#10">10. Proofs (Commitments / ZK)</a><ul><li><a href="#10.x">10.x Proof-of-Experiment (PoX)</a></li></ul></li><li><a href="#11">11. Offline Authority Protocol (OAP)</a></li><li><a href="#12">12. Profiles</a><ul><li><a href="#12.1">12.1 Research Profile (Strict)</a></li></ul></li><li><a href="#13">13. Observability &amp; Health</a></li><li><a href="#14">14. Security Model</a></li><li><a href="#15">15. Performance &amp; GC</a><ul><li><a href="#15.1">15.1 Exports and Explorer-Root (Normative)</a></li></ul></li><li><a href="#16">16. Compliance &amp; Tests (Normative)</a><ul><li><a href="#16.1">16.1 Consensus Integrity (Normative)</a></li><li><a href="#16.2">16.2 Additional Checks (Normative)</a></li></ul></li><li><a href="#17">17. CLI (Reference)</a></li><li><a href="#18">18. Example Use Case: A Git-Native Work Queue</a></li><li><a href="#19">19. Job Plane (Compute)</a><ul><li><a href="#19.1">19.1 Job Lifecycle</a></li><li><a href="#19.2">19.2 Job Discovery</a></li><li><a href="#19.3">19.3 Proof-Of-Execution</a></li></ul></li><li><a href="#20">20. Consensus Governance (Normative)</a><ul><li><a href="#20.1">20.1 Workflow</a></li><li><a href="#20.2">20.2 Commit Structures (Trailers)</a></li><li><a href="#20.3">20.3 Proof-Of-Consensus (PoC)</a></li><li><a href="#20.4">20.4 Lifecycle States</a></li><li><a href="#20.5">20.5 Revocation</a></li><li><a href="#20.6">20.6 Bus Topics (recommended)</a></li></ul></li><li><a href="#glossary">Glossary</a></li></ul><blockquote><p><em>The key to understanding GATOS is understanding that it&#39;s just Git.</em></p></blockquote><h2 id="git-as-the-operating-surface" tabindex="-1">Git As The Operating Surface <a class="header-anchor" href="#git-as-the-operating-surface" aria-label="Permalink to &quot;Git As The Operating Surface&quot;">​</a></h2><p><a id="git-as-the-operating-surface"></a></p><p><a id="git-as-the-operating-surface"></a></p><blockquote><p>You use Git for source control.<br><em>I use Git for reality control.</em><br><em>We are not the same.</em><br><strong>GATOS: Git Different.</strong></p></blockquote><table tabindex="0"><thead><tr><th></th><th></th></tr></thead><tbody><tr><td><strong>Status</strong></td><td>Draft (implementation underway)</td></tr><tr><td><strong>Scope</strong></td><td>Normative specification of data model, on-disk layout, protocols, and behavioral guarantees.</td></tr><tr><td><strong>Audience</strong></td><td>Implementers, auditors, integrators.</td></tr></tbody></table><hr><h2 id="_0-conventions" tabindex="-1">0. Conventions <a class="header-anchor" href="#_0-conventions" aria-label="Permalink to &quot;0. Conventions&quot;">​</a></h2><p><a id="0"></a><a id="0-conventions"></a></p><p><a id="0-conventions"></a><a id="0.-conventions"></a> The keywords <strong>MUST</strong>, <strong>MUST NOT</strong>, <strong>REQUIRED</strong>, <strong>SHALL</strong>, <strong>SHALL NOT</strong>, <strong>SHOULD</strong>, <strong>SHOULD NOT</strong>, <strong>RECOMMENDED</strong>, <strong>MAY</strong>, and <strong>OPTIONAL</strong> in this document are to be interpreted as described in <code>RFC 2119</code>.</p><figure><img src="'+s+'" alt="diagram 1" loading="lazy"></figure><p><strong>Git</strong> refers to any conformant implementation supporting refs, commits, trees, blobs, notes, and atomic ref updates.</p><p><strong>Hash</strong> defaults to BLAKE3 for content hashes and SHA-256 for policy bundle digests unless otherwise stated.</p><hr><h2 id="_1-system-model" tabindex="-1">1. System Model <a class="header-anchor" href="#_1-system-model" aria-label="Permalink to &quot;1. System Model&quot;">​</a></h2><p><a id="1"></a><a id="1-system-model"></a></p><p><a id="1-system-model"></a><a id="1.-system-model"></a> A <strong>GATOS node</strong> is a Git repository with a disciplined layout of refs, notes, and artifacts. A <strong>GATOS app</strong> is a set of <strong>schemas</strong>, <strong>policies</strong>, and <strong>folds</strong> that operate on <strong>append-only journals</strong> to produce <strong>deterministic state</strong>.</p><p><strong>GATOS</strong> defines five planes:</p><ol><li><strong>Ledger plane</strong> — append-only journals (<strong>events</strong>).</li><li><strong>State plane</strong> — deterministic folds (<strong>state roots</strong>).</li><li><strong>Policy/Trust plane</strong> — enforceable rules, grants, and multi-party consensus governance.</li><li><strong>Message plane</strong> — a commit-backed pub/sub bus.</li><li><strong>Job plane</strong> — Distributed, verifiable job execution.</li></ol><figure><img src="'+r+'" alt="diagram 2" loading="lazy"></figure><h3 id="requirements" tabindex="-1">Requirements <a class="header-anchor" href="#requirements" aria-label="Permalink to &quot;Requirements&quot;">​</a></h3><p><a id="requirements"></a></p><p><a id="requirements"></a></p><ul><li>Journals <strong>MUST</strong> be fast-forward-only.</li><li>State refs <strong>MUST</strong> be derivable from journals and policies.</li><li>Cache refs <strong>MUST</strong> be rebuildable and <strong>MUST NOT</strong> be authoritative.</li><li>Epochs <strong>MUST</strong> form a cryptographically-linked chain.</li></ul><hr><h2 id="_2-on-disk-layout-normative" tabindex="-1">2. On-Disk Layout (Normative) <a class="header-anchor" href="#_2-on-disk-layout-normative" aria-label="Permalink to &quot;2. On-Disk Layout (Normative)&quot;">​</a></h2><p><a id="2"></a><a id="2-on-disk-layout-normative"></a></p><p><a id="2-on-disk-layout-normative"></a><a id="2.-on-disk-layout-normative"></a><a id="2.-ondisk-layout-normative"></a> The following diagram illustrates the primary locations for GATOS artifacts within the Git repository (<code>.git</code>) and the working tree.</p><figure><img src="'+n+`" alt="diagram 3" loading="lazy"></figure><p>The normative layout is as follows:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>.git/</span></span>
<span class="line"><span>├── refs/</span></span>
<span class="line"><span>│   └── gatos/</span></span>
<span class="line"><span>│       ├── journal/</span></span>
<span class="line"><span>│       ├── state/</span></span>
<span class="line"><span>│       ├── mbus/</span></span>
<span class="line"><span>│       ├── mbus-ack/</span></span>
<span class="line"><span>│       ├── jobs/</span></span>
<span class="line"><span>│       │   └── &lt;job-id&gt;/</span></span>
<span class="line"><span>│       │       └── claim</span></span>
<span class="line"><span>│       ├── proposals/</span></span>
<span class="line"><span>│       ├── approvals/</span></span>
<span class="line"><span>│       ├── grants/</span></span>
<span class="line"><span>│       └── revocations/</span></span>
<span class="line"><span>│       ├── sessions/</span></span>
<span class="line"><span>│       ├── audit/</span></span>
<span class="line"><span>│       ├── cache/</span></span>
<span class="line"><span>│       └── epoch/</span></span>
<span class="line"><span>│       └── policies/</span></span>
<span class="line"><span>└── gatos/</span></span>
<span class="line"><span>    ├── policies/</span></span>
<span class="line"><span>    ├── schema/</span></span>
<span class="line"><span>    ├── folds/</span></span>
<span class="line"><span>    ├── trust/</span></span>
<span class="line"><span>    ├── objects/</span></span>
<span class="line"><span>    └── config/</span></span></code></pre></div><p>Policy bundles (Normative).</p><ul><li><p>Storage: Each policy bundle <strong>MUST</strong> be recorded as a commit on</p><p><code>refs/gatos/policies/&lt;bundle-id&gt;</code>, where <code>&lt;bundle-id&gt;</code> is a stable identifier (e.g., <code>blake3(policy_tree)</code> or a ULID). The commit’s tree contains the compiled policy artifacts; the commit trailers <strong>MUST</strong> include <code>Policy-Root: &lt;commit-oid&gt;</code> and <code>Policy-Code-Root: sha256:&lt;hex&gt;</code>.</p></li><li><p>Lineage: Bundle lineage <strong>MUST</strong> be represented by commit ancestry on the</p><p>same ref (append-only). Historical bundles remain reachable.</p></li><li><p>Active pointer: Implementations <strong>MUST</strong> expose the effective bundle via</p><p><code>refs/gatos/policies/active</code> pointing to the commit OID of the active bundle. Updates to <code>refs/gatos/policies/**</code> (including <code>active</code>) <strong>MUST</strong> be fast-forward only. <code>active</code> is a plain ref (not a tag).</p></li><li><p>Consumers: Policy Gate evaluation <strong>MUST</strong> read the current policy from</p><p><code>refs/gatos/policies/active</code>. Verifiers and CLIs <strong>SHOULD</strong> default to the same unless explicitly overridden by a flag.</p></li><li><p>Mutation workflow: Promote a candidate bundle by fast-forwarding</p><p><code>refs/gatos/policies/&lt;bundle-id&gt;</code> and then atomically updating <code>refs/gatos/policies/active</code> to that commit (both operations FF-only).</p></li></ul><hr><h2 id="_3-identities-actors-and-grants" tabindex="-1">3. Identities, Actors, and Grants <a class="header-anchor" href="#_3-identities-actors-and-grants" aria-label="Permalink to &quot;3. Identities, Actors, and Grants&quot;">​</a></h2><p><a id="3"></a><a id="3-identities-actors-and-grants"></a></p><p><a id="3-identities-actors-and-grants"></a><a id="3.-identities-actors-and-grants"></a></p><h3 id="_3-1-actors" tabindex="-1">3.1 Actors <a class="header-anchor" href="#_3-1-actors" aria-label="Permalink to &quot;3.1 Actors&quot;">​</a></h3><p><a id="3.1"></a><a id="31-actors"></a></p><p><a id="3.1"></a><a id="31-actors"></a><a id="3.1-actors"></a><a id="31"></a> Actors are strings of the form: <code>user:&lt;name&gt;</code>, <code>agent:&lt;name&gt;</code>, or <code>service:&lt;name&gt;</code>.</p><h3 id="_3-2-capability-grants" tabindex="-1">3.2 Capability Grants <a class="header-anchor" href="#_3-2-capability-grants" aria-label="Permalink to &quot;3.2 Capability Grants&quot;">​</a></h3><p><a id="3.2"></a><a id="32-capability-grants"></a></p><p><a id="3.2"></a><a id="32-capability-grants"></a><a id="3.2-capability-grants"></a><a id="32"></a> Grants link an <code>issuer</code> Actor to a <code>subject</code> Actor, bestowing a set of capabilities (<code>caps</code>) that are valid until an expiration date (<code>exp</code>).</p><figure><img src="`+l+'" alt="diagram 4" loading="lazy"></figure><p><strong>Grants</strong> <strong>MUST</strong> be committed under <code>gatos/trust/grants/</code>. Verifiers <strong>MUST</strong> validate the signature, issuer trust, audience, and expiry.</p><hr><h2 id="_4-events-ledger-plane" tabindex="-1">4. Events (Ledger Plane) <a class="header-anchor" href="#_4-events-ledger-plane" aria-label="Permalink to &quot;4. Events (Ledger Plane)&quot;">​</a></h2><p><a id="4"></a><a id="4-events-ledger-plane"></a></p><p><a id="4-events-ledger-plane"></a><a id="4.-events-ledger-plane"></a></p><h3 id="_4-1-event-envelope" tabindex="-1">4.1 Event Envelope <a class="header-anchor" href="#_4-1-event-envelope" aria-label="Permalink to &quot;4.1 Event Envelope&quot;">​</a></h3><p><a id="4.1"></a><a id="41-event-envelope"></a></p><p><a id="4.1"></a><a id="41-event-envelope"></a><a id="4.1-event-envelope"></a><a id="41"></a> All actions in GATOS are initiated via a signed Event.</p><figure><img src="'+d+'" alt="diagram 5" loading="lazy"></figure><p>Field semantics and compatibility:</p><ul><li><p><code>sig_alg</code> — algorithm identifier; for v1, implementations <strong>MUST</strong> support</p><p><code>ed25519</code>; other algorithms (e.g., <code>ecdsa-p256</code>) <strong>MAY</strong> be accepted by agreement. When omitted, verifiers <strong>MUST</strong> infer the algorithm from the signature material or commit metadata.</p></li><li><p><code>ts</code> — RFC 3339/ISO-8601 timestamp in UTC (<code>YYYY-MM-DDTHH:MM:SSZ</code>). When</p><p>omitted, receivers <strong>MAY</strong> use the commit timestamp for display only; the envelope remains valid without <code>ts</code>.</p></li><li><p>Back/forward compatibility — Fields not present in older envelopes are simply</p><p>absent from the canonical encoding. Receivers <strong>MUST</strong> accept envelopes with or without <code>sig_alg</code>/<code>ts</code>. Canonical bytes are computed over the envelope with <code>sig</code> omitted and only the fields that are present.</p></li></ul><p>Canonicalization and signing:</p><ul><li>Encode the envelope (with <code>sig</code> omitted) as <strong>DAG-CBOR</strong> to produce canonical bytes.</li><li>Content addressing: <code>Event-CID = cidv1(dag-cbor, blake3(canonical_bytes))</code>.</li><li>Sign <code>canonical_bytes</code> with <code>sig_alg</code> (e.g., <code>ed25519</code>); record signature in commit trailers.</li><li>Recommended trailers: <code>Event-CID</code>, <code>Sig-Alg</code>, <code>Sig</code>.</li></ul><h3 id="_4-2-journal-semantics" tabindex="-1">4.2 Journal Semantics <a class="header-anchor" href="#_4-2-journal-semantics" aria-label="Permalink to &quot;4.2 Journal Semantics&quot;">​</a></h3><p><a id="4.2"></a><a id="42-journal-semantics"></a></p><p><a id="4.2"></a><a id="42-journal-semantics"></a><a id="4.2-journal-semantics"></a><a id="42"></a> Appending an event <strong>MUST</strong> create a new commit on an append-only ref in <code>refs/gatos/journal/&lt;ns&gt;/&lt;actor&gt;</code>. Ref updates <strong>MUST</strong> use atomic compare-and-swap via <code>git update-ref &lt;old&gt; &lt;new&gt;</code>.</p><p>CAS failure and idempotency:</p><ul><li><p>On <code>update-ref</code> failure (old OID mismatch), writers <strong>MUST</strong> refetch and</p><p>retry. Writers <strong>SHOULD</strong> implement jittered exponential backoff (e.g., base=25 ms, max≈500 ms) and <strong>SHOULD</strong> cap retries (e.g., 5 attempts) before surfacing an error to the caller.</p></li><li><p>Clients <strong>SHOULD</strong> supply <code>ulid</code> as an idempotency key; gates <strong>MAY</strong> reject</p><p>duplicate ULIDs within a configured horizon.</p></li><li><p>Journals are linear; divergence is resolved by retrying the CAS against the</p><p>latest head. Merges into journal refs are forbidden.</p></li></ul><hr><h2 id="_5-state-deterministic-folds" tabindex="-1">5. State (Deterministic Folds) <a class="header-anchor" href="#_5-state-deterministic-folds" aria-label="Permalink to &quot;5. State (Deterministic Folds)&quot;">​</a></h2><p><a id="5"></a><a id="5-state-deterministic-folds"></a></p><p><a id="5-state-deterministic-folds"></a><a id="5.-state-deterministic-folds"></a></p><h3 id="_5-1-fold-function" tabindex="-1">5.1 Fold Function <a class="header-anchor" href="#_5-1-fold-function" aria-label="Permalink to &quot;5.1 Fold Function&quot;">​</a></h3><p><a id="5.1"></a><a id="51-fold-function"></a></p><p><a id="5.1"></a><a id="51-fold-function"></a><a id="5.1-fold-function"></a><a id="51"></a> A <strong>fold</strong> is a pure function: $state_root = F(events_stream, policy_root)$.</p><figure><img src="'+c+`" alt="diagram 6" loading="lazy"></figure><p>For identical inputs, and the same <code>policy_root</code>, the byte sequence of <code>state_root</code> <strong>MUST</strong> be identical.</p><h3 id="_5-2-fold-spec-checkpoints" tabindex="-1">5.2 Fold Spec &amp; Checkpoints <a class="header-anchor" href="#_5-2-fold-spec-checkpoints" aria-label="Permalink to &quot;5.2 Fold Spec &amp; Checkpoints&quot;">​</a></h3><p><a id="5.2"></a><a id="52-fold-spec--checkpoints"></a></p><p><a id="5.2"></a><a id="52-fold-spec--checkpoints"></a><a id="5.2-fold-spec-checkpoints"></a><a id="52"></a> A Fold is defined by a <code>.yaml</code> spec and a compiled EchoLua program (ELC). The EchoLua source is compiled to ELC (serialized DAG-CBOR); <code>fold_root = sha256(ELC_bytes)</code>. Its output, a <strong>State Checkpoint</strong>, is a commit on <code>refs/gatos/state/&lt;ns&gt;</code> whose tree contains the materialized state artifacts.</p><blockquote><p>See also</p><ul><li>Hello walkthrough (Ops): <a href="./guide/HELLO-OPS.html">HELLO-OPS</a> shows append → fold → verify trailers.</li><li>Hello walkthrough (Privacy): <a href="./guide/HELLO-PRIVACY.html">HELLO-PRIVACY</a> shows pointers and deterministic public folds.</li></ul></blockquote><h3 id="_5-3-state-checkpoint-trailers-normative" tabindex="-1">5.3 State Checkpoint Trailers (Normative) <a class="header-anchor" href="#_5-3-state-checkpoint-trailers-normative" aria-label="Permalink to &quot;5.3 State Checkpoint Trailers (Normative)&quot;">​</a></h3><p><a id="5.3"></a><a id="53-state-checkpoint-trailers-normative"></a></p><p><a id="5.3"></a><a id="53-state-checkpoint-trailers-normative"></a><a id="5.3-state-checkpoint-trailers-normative"></a><a id="53"></a> Every state checkpoint commit under <code>refs/gatos/state/&lt;ns&gt;</code> <strong>MUST</strong> include the following trailers with canonical encodings:</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>State-Root: blake3:&lt;hex&gt;                 # lowercase hex digest of canonical state</span></span>
<span class="line"><span>Ledger-Head: &lt;commit-oid&gt;                # last ledger commit included in this fold</span></span>
<span class="line"><span>Policy-Root: &lt;commit-oid&gt;                # commit/digest that identifies the effective policy</span></span>
<span class="line"><span>Policy-Code-Root: sha256:&lt;hex&gt;           # canonical hash of policy code used (ELC/.rgc)</span></span>
<span class="line"><span>Fold-Engine: echo@&lt;semver&gt;+elc@&lt;semver&gt;+num=q32.32+rng=pcg32@&lt;ver&gt;</span></span>
<span class="line"><span>Fold-Root: sha256:&lt;hex&gt;                  # hash of EchoLua IR bytes (ELC)</span></span>
<span class="line"><span>Fold-Version: &lt;schema-version&gt;            # application/shape schema version</span></span>
<span class="line"><span>Fold-Math: fixed-q32.32                   # numeric model (normative in v1)</span></span>
<span class="line"><span>Fold-RNG: pcg32@&lt;ver&gt;                     # RNG algorithm id + version (if used)</span></span></code></pre></div><p>Validation and compatibility:</p><ul><li><p>Verifiers <strong>MUST</strong> require at least: <code>State-Root</code>, <code>Ledger-Head</code>,</p><p><code>Policy-Root</code>, <code>Fold-Root</code>, and <code>Fold-Engine</code>. Unknown trailers <strong>MUST</strong> be ignored.</p></li><li><p>When optional trailers (e.g., <code>Fold-RNG</code>, <code>Fold-Math</code>) are absent, verifiers</p><p><strong>MUST</strong> apply implementation defaults for the declared profile and still accept the checkpoint.</p></li><li><p>Trailer values <strong>MUST</strong> use the prefixed canonical encodings shown above.</p></li></ul><p>These rules enable portable verification and reproducible builds of state across nodes and platforms.</p><blockquote><p>Cross-reference</p><ul><li>TECH-SPEC fold/verification references these trailers.</li><li>Walkthrough usage: <a href="./guide/HELLO-OPS.html#2-fold-to-state-and-inspect">HELLO-OPS</a>.</li></ul></blockquote><h3 id="_5-4-proof-of-fold-pof" tabindex="-1">5.4 Proof-of-Fold (PoF) <a class="header-anchor" href="#_5-4-proof-of-fold-pof" aria-label="Permalink to &quot;5.4 Proof-of-Fold (PoF)&quot;">​</a></h3><p><a id="5.4"></a><a id="54-proof-of-fold-pof"></a></p><p><a id="5.4"></a><a id="54-proof-of-fold-pof"></a><a id="5.4-proof-of-fold-pof"></a><a id="54"></a><a id="5.4-proof-of-fold"></a> A <strong>Proof-of-Fold (PoF)</strong> binds a state checkpoint to the exact ledger window and fold definition used to derive it.</p><p>At minimum, a PoF MUST commit to:</p><ul><li><code>Ledger-Start</code> and <code>Ledger-End</code> commit OIDs (inclusive window),</li><li><code>Policy-Root</code> (or policy digest) used for gate decisions affecting the fold,</li><li><code>Fold-Id</code> (stable identifier or digest of the fold function/spec),</li><li><code>Fold-Root</code> (sha256 of ELC bytes),</li><li><code>State-Root</code> (content hash of the resulting checkpoint),</li><li><code>Policy-Code-Root</code> (sha256 of the canonicalized policy code/ELC),</li><li>Signatures of the folding actor(s) when required by policy.</li></ul><p>Implementations MAY embed PoF in commit trailers or attach a sidecar manifest. Verifiers MUST recompute the fold over the declared window and compare the resulting <code>State-Root</code>.</p><hr><h2 id="_6-policy-decision-audit" tabindex="-1">6. Policy &amp; Decision Audit <a class="header-anchor" href="#_6-policy-decision-audit" aria-label="Permalink to &quot;6. Policy &amp; Decision Audit&quot;">​</a></h2><p><a id="6"></a><a id="6-policy--decision-audit"></a></p><p><a id="6-policy--decision-audit"></a><a id="6.-policy-decision-audit"></a></p><h3 id="_6-1-gate-contract" tabindex="-1">6.1 Gate Contract <a class="header-anchor" href="#_6-1-gate-contract" aria-label="Permalink to &quot;6.1 Gate Contract&quot;">​</a></h3><p><a id="6.1"></a><a id="61-gate-contract"></a></p><p><a id="6.1"></a><a id="61-gate-contract"></a><a id="6.1-gate-contract"></a><a id="61"></a> All events are evaluated by a Policy Gate before being accepted. Gates that execute policy code MUST adhere to the <a href="./deterministic-lua.html">Deterministic Lua (EchoLua)</a> runtime profile. Policy is authored in <code>.rgs</code> and compiled to <code>.rgc</code>/ELC; policy bundles and proofs MUST record <code>Policy-Code-Root</code> so the exact governing code is recoverable. $Decision = Gate.evaluate(intent, context) -&gt; {Allow | Deny(reason)}$</p><p>Note: A deterministic execution profile for Lua will be documented (see <a href="./deterministic-lua.html">Deterministic Lua</a>); policy engines <strong>SHOULD</strong> adhere to that profile to ensure portable verification.</p><figure><img src="`+p+'" alt="diagram 7" loading="lazy"></figure><p>On <strong>DENY</strong>, the gate <strong>MUST</strong> append an audit decision to <code>refs/gatos/audit/policy</code>.</p><blockquote><p>Important: DENY is always logged under audit. Each decision MUST include the policy rule identifier (<code>Policy-Rule</code>), a reproducible reason, and sufficient context (actor, target, refs) for independent verification.</p></blockquote><hr><h2 id="_7-blob-pointers-opaque-storage-hybrid-privacy" tabindex="-1">7. Blob Pointers &amp; Opaque Storage (Hybrid Privacy) <a class="header-anchor" href="#_7-blob-pointers-opaque-storage-hybrid-privacy" aria-label="Permalink to &quot;7. Blob Pointers &amp; Opaque Storage (Hybrid Privacy)&quot;">​</a></h2><p><a id="7"></a><a id="7-blob-pointers--opaque-storage-hybrid-privacy"></a></p><p><a id="7-blob-pointers--opaque-storage-hybrid-privacy"></a><a id="7.-blob-pointers-opaque-storage-hybrid-privacy"></a> Large or sensitive data is stored out-of-band in a content-addressed store and referenced via pointers.</p><figure><img src="'+g+'" alt="diagram 8" loading="lazy"></figure><p>Pointers <strong>MUST</strong> refer to bytes in <code>gatos/objects/&lt;algo&gt;/&lt;hash&gt;</code>. For opaque objects, no plaintext <strong>MAY</strong> be stored in Git. Public pointers in low-entropy classes <strong>MUST NOT</strong> reveal a plaintext digest; they <strong>MUST</strong> include a ciphertext digest. Pointer <code>size</code> <strong>SHOULD</strong> be bucketed (e.g., 1 KB/4 KB/16 KB/64 KB). If a plaintext commitment is required, use a hiding commitment and store it inside <code>encrypted_meta</code>.</p><p>Compatibility note: previous drafts referred to <code>cipher_meta</code>; the normative field name is now <code>encrypted_meta</code>. Implementations <strong>SHOULD</strong> accept inputs using either name and <strong>MUST</strong> emit <code>encrypted_meta</code> going forward.</p><hr><h2 id="_8-message-bus-commit-backed-pub-sub" tabindex="-1">8. Message Bus (Commit-Backed Pub/Sub) <a class="header-anchor" href="#_8-message-bus-commit-backed-pub-sub" aria-label="Permalink to &quot;8. Message Bus (Commit-Backed Pub/Sub)&quot;">​</a></h2><p><a id="8"></a><a id="8-message-bus-commit-backed-pubsub"></a></p><p><a id="8-message-bus-commit-backed-pubsub"></a><a id="8.-message-bus-commit-backed-pubsub"></a><a id="8.-message-bus-commitbacked-pubsub"></a> The message bus provides a pub/sub system built on Git commits.</p><figure><img src="'+u+'" alt="diagram 9" loading="lazy"></figure><p>Messages are appended to <code>refs/gatos/mbus/&lt;topic&gt;/&lt;shard&gt;</code>. Delivery is <strong>at-least-once</strong>; consumers <strong>MUST</strong> dedupe on read using the message <code>ULID</code> (or content hash) as an idempotency key and <strong>MAY</strong> write <code>ack</code>s to <code>refs/gatos/mbus-ack/</code>. Producers <strong>SHOULD</strong> set idempotency keys.</p><p>Retention and compaction:</p><ul><li>Segment topics by date and ULID (e.g., <code>&lt;topic&gt;/&lt;yyyy&gt;/&lt;mm&gt;/&lt;dd&gt;/&lt;segment-ulid&gt;</code>) and rotate when either a message or size threshold is reached (defaults: 100k messages or ~192 MB).</li><li>Apply TTL to old segments (default: 30 days) and write a summary commit per pruned window (counts + Merkle root of message bodies + last offsets) to preserve verifiable history.</li><li>Deployments <strong>SHOULD</strong> enable <code>fetch.writeCommitGraph=true</code> and <code>repack.writeBitmaps=true</code> for busy topics.</li></ul><hr><h2 id="_9-sessions-working-branches" tabindex="-1">9. Sessions (Working Branches) <a class="header-anchor" href="#_9-sessions-working-branches" aria-label="Permalink to &quot;9. Sessions (Working Branches)&quot;">​</a></h2><p><a id="9"></a><a id="9-sessions-working-branches"></a></p><p><a id="9-sessions-working-branches"></a><a id="9.-sessions-working-branches"></a><code>gatos/sessions/&lt;actor&gt;/&lt;ulid&gt;</code> represents an ephemeral branch for interactive mutation.</p><figure><img src="'+h+'" alt="diagram 10" loading="lazy"></figure><hr><h2 id="_10-proofs-commitments-zk" tabindex="-1">10. Proofs (Commitments / ZK) <a class="header-anchor" href="#_10-proofs-commitments-zk" aria-label="Permalink to &quot;10. Proofs (Commitments / ZK)&quot;">​</a></h2><p><a id="10"></a><a id="10-proofs-commitments--zk"></a></p><p><a id="10-proofs-commitments--zk"></a><a id="10.-proofs-commitments-zk"></a> A proof envelope attests to the deterministic execution of a fold or job. Where applicable, proofs MUST record <code>Policy-Code-Root</code> alongside <code>Policy-Root</code> so the governing policy code is unambiguously identified.</p><figure><img src="'+m+'" alt="diagram 11" loading="lazy"></figure><p>Proofs <strong>MUST</strong> be stored under <code>refs/gatos/audit/proofs/&lt;ns&gt;</code>.</p><h3 id="_10-x-proof-of-experiment-pox" tabindex="-1">10.x Proof-of-Experiment (PoX) <a class="header-anchor" href="#_10-x-proof-of-experiment-pox" aria-label="Permalink to &quot;10.x Proof-of-Experiment (PoX)&quot;">​</a></h3><p><a id="10.x"></a><a id="10x-proof-of-experiment-pox"></a></p><p><a id="10.x"></a><a id="10x-proof-of-experiment-pox"></a><a id="10.x-proof-of-experiment-pox"></a> A <strong>PoX</strong> envelope ties together a scientific artifact’s inputs, program, policy, and outputs:</p><ul><li><code>inputs_root</code> — commitment to input datasets/pointers</li><li><code>program_id</code> — canonical hash of the analysis program/container</li><li><code>policy_root</code> — policy in effect</li><li><code>outputs_root</code> — commitment to results</li><li>Links to associated PoE (jobs) and PoF (state) where applicable</li></ul><p>PoX envelopes <strong>MUST</strong> be stored under <code>refs/gatos/audit/proofs/experiments/&lt;ulid&gt;</code>.</p><hr><h2 id="_11-offline-authority-protocol-oap" tabindex="-1">11. Offline Authority Protocol (OAP) <a class="header-anchor" href="#_11-offline-authority-protocol-oap" aria-label="Permalink to &quot;11. Offline Authority Protocol (OAP)&quot;">​</a></h2><p><a id="11"></a><a id="11-offline-authority-protocol-oap"></a></p><p><a id="11-offline-authority-protocol-oap"></a><a id="11.-offline-authority-protocol-oap"></a> OAP governs how divergent changes from offline peers are reconciled upon reconnecting.</p><figure><img src="'+f+'" alt="diagram 12" loading="lazy"></figure><hr><h2 id="_12-profiles" tabindex="-1">12. Profiles <a class="header-anchor" href="#_12-profiles" aria-label="Permalink to &quot;12.  Profiles&quot;">​</a></h2><p><a id="12"></a><a id="12--profiles"></a></p><p><a id="12--profiles"></a><a id="12.-profiles"></a> Profiles define the enforcement and operational mode of a GATOS node.</p><figure><img src="'+b+'" alt="diagram 13" loading="lazy"></figure><p>Nodes <strong>MUST</strong> discover the active profile via <code>gatos/config/profile.yaml</code>.</p><h3 id="_12-1-research-profile-strict" tabindex="-1">12.1 Research Profile (Strict) <a class="header-anchor" href="#_12-1-research-profile-strict" aria-label="Permalink to &quot;12.1 Research Profile (Strict)&quot;">​</a></h3><p><a id="12.1"></a><a id="121-research-profile-strict"></a></p><p><a id="12.1"></a><a id="121-research-profile-strict"></a><a id="12.1-research-profile-strict"></a> Profile id: <code>research</code>.</p><p>Defaults (normative for this profile):</p><ul><li>Proof-of-Fold required on state pushes: pre-receive MUST verify PoF for updates to <code>refs/gatos/state/**</code>.</li><li>Fast-forward-only refs: <code>refs/gatos/policies/**</code>, <code>refs/gatos/state/**</code>, and <code>refs/gatos/audit/**</code>.</li><li>GC anchors: <code>refs/gatos/audit/**</code> and the latest <code>refs/gatos/state/**</code> checkpoints.</li><li>Message bus segmentation and TTL: rotate segments at 100k messages or ~192 MB; TTL 30 days; write summary commits for pruned windows.</li><li>Public pointer hardening: low-entropy classes MUST NOT expose plaintext digests; public pointers MUST include a ciphertext digest; sizes SHOULD be bucketed (e.g., 1 KB, 4 KB, 16 KB, 64 KB).</li></ul><p>Nodes advertising the <code>research</code> profile MUST expose diagnostics for the above and SHOULD surface violations in <code>gatos doctor</code>.</p><hr><h2 id="_13-observability-health" tabindex="-1">13. Observability &amp; Health <a class="header-anchor" href="#_13-observability-health" aria-label="Permalink to &quot;13.  Observability &amp; Health&quot;">​</a></h2><p><a id="13"></a><a id="13--observability--health"></a></p><p><a id="13--observability--health"></a><a id="13.-observability-health"></a> Implementations <strong>SHOULD</strong> expose metrics and provide a health-check CLI command.</p><figure><img src="'+v+'" alt="diagram 14" loading="lazy"></figure><hr><h2 id="_14-security-model" tabindex="-1">14. Security Model <a class="header-anchor" href="#_14-security-model" aria-label="Permalink to &quot;14.  Security Model&quot;">​</a></h2><p><a id="14"></a><a id="14--security-model"></a></p><p><a id="14--security-model"></a><a id="14.-security-model"></a> The security model is deny-by-default, governed by capability grants evaluated by the policy engine.</p><figure><img src="'+y+'" alt="diagram 15" loading="lazy"></figure><hr><h2 id="_15-performance-gc" tabindex="-1">15. Performance &amp; GC <a class="header-anchor" href="#_15-performance-gc" aria-label="Permalink to &quot;15.  Performance &amp; GC&quot;">​</a></h2><p><a id="15"></a><a id="15--performance--gc"></a></p><p><a id="15--performance--gc"></a><a id="15.-performance-gc"></a> Epoch compaction is used to manage repository size over time.</p><figure><img src="'+_+'" alt="diagram 16" loading="lazy"></figure><h3 id="_15-1-exports-and-explorer-root-normative" tabindex="-1">15.1 Exports and Explorer-Root (Normative) <a class="header-anchor" href="#_15-1-exports-and-explorer-root-normative" aria-label="Permalink to &quot;15.1 Exports and Explorer-Root (Normative)&quot;">​</a></h3><p><a id="15.1"></a><a id="151-exports-and-explorer-root-normative"></a></p><p><a id="15.1"></a><a id="151-exports-and-explorer-root-normative"></a><a id="15.1-exports-and-explorer-root-normative"></a><a id="151"></a><a id="15.1-exports-and-explorerroot-normative"></a> Exporters that materialize views <strong>MUST</strong> emit an <code>Explorer-Root</code> checksum.</p><ul><li>For derived state exports (materialized from folds), include the fold identity:</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Explorer-Root = blake3(ledger_head || policy_root || fold_root || extractor_version)</span></span></code></pre></div><ul><li>For raw ledger exports (no folds applied), omit <code>fold_root</code>:</li></ul><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Explorer-Root = blake3(ledger_head || policy_root || extractor_version)</span></span></code></pre></div><p>The <code>gatos export verify</code> command <strong>MUST</strong> recompute <code>Explorer-Root</code> against the repository and report mismatches.</p><hr><h2 id="_16-compliance-tests-normative" tabindex="-1">16. Compliance &amp; Tests (Normative) <a class="header-anchor" href="#_16-compliance-tests-normative" aria-label="Permalink to &quot;16.  Compliance &amp; Tests (Normative)&quot;">​</a></h2><p><a id="16"></a><a id="16--compliance--tests-normative"></a></p><p><a id="16--compliance--tests-normative"></a><a id="16.-compliance-tests-normative"></a> Implementations <strong>MUST</strong> pass a six-point certification inspection.</p><figure><img src="'+k+'" alt="diagram 17" loading="lazy"></figure><h3 id="_16-1-consensus-integrity-normative" tabindex="-1">16.1 Consensus Integrity (Normative) <a class="header-anchor" href="#_16-1-consensus-integrity-normative" aria-label="Permalink to &quot;16.1 Consensus Integrity (Normative)&quot;">​</a></h3><p><a id="16.1"></a><a id="161-consensus-integrity-normative"></a></p><p><a id="16.1"></a><a id="161-consensus-integrity-normative"></a><a id="16.1-consensus-integrity-normative"></a><a id="161"></a></p><ul><li>An action gated by a <code>2-of-3</code> quorum policy MUST be denied with 1 approval and MUST be allowed with 2 approvals.</li><li>A revoked grant MUST NOT be usable.</li></ul><h3 id="_16-2-additional-checks-normative" tabindex="-1">16.2 Additional Checks (Normative) <a class="header-anchor" href="#_16-2-additional-checks-normative" aria-label="Permalink to &quot;16.2 Additional Checks (Normative)&quot;">​</a></h3><p><a id="16.2"></a><a id="162-additional-checks-normative"></a></p><p><a id="16.2"></a><a id="162-additional-checks-normative"></a><a id="16.2-additional-checks-normative"></a><a id="162"></a></p><ul><li>PoF required: state pushes to <code>refs/gatos/state/**</code> MUST include a verifiable Proof-of-Fold.</li><li>Policies FF-only: <code>refs/gatos/policies/**</code> MUST be fast-forward only.</li><li>Exclusive job claim: exactly one worker MUST succeed in creating <code>refs/gatos/jobs/&lt;job-id&gt;/claim</code> via compare-and-swap.</li><li>Pointer privacy: public pointers for low-entropy classes MUST NOT expose plaintext digests; ciphertext digest present; sizes bucketed.</li><li>Exports: exporters MUST emit <code>Explorer-Root = blake3(ledger_head || policy_root || extractor_version)</code> and <code>gatos export verify</code> MUST validate it.</li></ul><hr><h2 id="_17-cli-reference" tabindex="-1">17. CLI (Reference) <a class="header-anchor" href="#_17-cli-reference" aria-label="Permalink to &quot;17. CLI (Reference)&quot;">​</a></h2><p><a id="17"></a><a id="17-cli-reference"></a></p><p><a id="17-cli-reference"></a><a id="17.-cli-reference"></a> The <code>git gatos</code> command provides the primary user interface.</p><figure><img src="'+x+'" alt="diagram 18" loading="lazy"></figure><p>Key verbs (non-exhaustive):</p><ul><li><code>verify</code> — verify PoX/PoF/PoE signatures &amp; ancestry.</li><li><code>reproduce &lt;pox-id&gt;</code> — fetch pointers, run jobs (PoE), check PoF; report identical/diff.</li><li><code>bisect --state=&lt;ref&gt; --good &lt;ts|commit&gt; --bad &lt;ts|commit&gt; --predicate &lt;script|jq&gt;</code> — binary search over checkpoints.</li><li><code>export parquet|sqlite</code> — emit Explorer-Root; <code>export verify &lt;path&gt;</code> compares it.</li><li><code>foldc &lt;src.lua&gt; -o &lt;out.elc&gt;</code> — compile EchoLua to ELC (records engine id).</li><li><code>policyc &lt;src.rgs&gt; -o &lt;out.rgc&gt;</code> — compile .rgs policy DSL to deterministic IR/ELC.</li></ul><p>See also:</p><ul><li>CLI guides: <a href="./cli/foldc.html">foldc</a>, <a href="./cli/policyc.html">policyc</a>, <a href="./cli/export.html">export</a>, <a href="./cli/pox.html">pox</a>, <a href="./cli/lint.html">lint</a>.</li></ul><hr><h2 id="_18-example-use-case-a-git-native-work-queue" tabindex="-1">18. Example Use Case: A Git-Native Work Queue <a class="header-anchor" href="#_18-example-use-case-a-git-native-work-queue" aria-label="Permalink to &quot;18. Example Use Case: A Git-Native Work Queue&quot;">​</a></h2><p><a id="18"></a><a id="18-example-use-case-a-git-native-work-queue"></a></p><p><a id="18-example-use-case-a-git-native-work-queue"></a><a id="18.-example-use-case-a-git-native-work-queue"></a> This diagram shows the data flow for enqueuing and processing a job.</p><figure><img src="'+P+'" alt="diagram 19" loading="lazy"></figure><hr><h2 id="_19-job-plane-compute" tabindex="-1">19. Job Plane (Compute) <a class="header-anchor" href="#_19-job-plane-compute" aria-label="Permalink to &quot;19. Job Plane (Compute)&quot;">​</a></h2><p><a id="19"></a><a id="19-job-plane-compute"></a></p><p><a id="19-job-plane-compute"></a><a id="19.-job-plane-compute"></a> See also: <a href="./decisions/ADR-0002/DECISION.html">ADR-0002</a>.</p><p>The Job Plane provides a system for scheduling, executing, and recording the results of distributed, asynchronous jobs.</p><h3 id="_19-1-job-lifecycle" tabindex="-1">19.1 Job Lifecycle <a class="header-anchor" href="#_19-1-job-lifecycle" aria-label="Permalink to &quot;19.1 Job Lifecycle&quot;">​</a></h3><p><a id="19.1"></a><a id="191-job-lifecycle"></a></p><p><a id="19.1"></a><a id="191-job-lifecycle"></a><a id="19.1-job-lifecycle"></a><a id="191"></a> This diagram illustrates how the state of a Job transitions based on events recorded in the GATOS ledger.</p><figure><img src="'+S+`" alt="diagram 20" loading="lazy"></figure><p>The lifecycle is represented entirely through Git objects:</p><ul><li><strong>Job:</strong> A commit whose tree contains a <code>job.yaml</code> manifest.</li><li><strong>Claim:</strong> An atomic ref under <code>refs/gatos/jobs/&lt;job-id&gt;/claims/&lt;worker-id&gt;</code>, where <code>&lt;job-id&gt;</code> is the canonical BLAKE3 <code>content_id</code> of the job manifest (see ADR-0002 Canonical Job Identifier).</li><li><strong>Result:</strong> A commit referencing the job commit, containing a <code>Proof-Of-Execution</code>.</li></ul><h3 id="_19-2-job-discovery" tabindex="-1">19.2 Job Discovery <a class="header-anchor" href="#_19-2-job-discovery" aria-label="Permalink to &quot;19.2 Job Discovery&quot;">​</a></h3><p><a id="19.2"></a><a id="192-job-discovery"></a></p><p><a id="19.2"></a><a id="192-job-discovery"></a><a id="19.2-job-discovery"></a><a id="192"></a> When a <strong>Job</strong> commit is created, a message <strong>MUST</strong> be published to a topic on the Message Plane for discovery by workers. Delivery is at-least-once; workers MUST be idempotent.</p><h3 id="_19-3-proof-of-execution" tabindex="-1">19.3 Proof-Of-Execution <a class="header-anchor" href="#_19-3-proof-of-execution" aria-label="Permalink to &quot;19.3 Proof-Of-Execution&quot;">​</a></h3><p><a id="19.3"></a><a id="193-proof-of-execution"></a></p><p><a id="19.3"></a><a id="193-proof-of-execution"></a><a id="19.3-proof-of-execution"></a><a id="193"></a> The <strong>Proof-Of-Execution (PoE)</strong> MUST sign the job’s canonical <code>content_id</code> (BLAKE3 of the canonical unsigned job core). Trailers MUST use canonical, prefixed encodings as follows:</p><ul><li><code>Job-Id: blake3:&lt;hex&gt;</code> — canonical job identifier (content_id)</li><li><code>Proof-Of-Execution: blake3:&lt;hex&gt;</code> — digest of the PoE envelope</li><li><code>Worker-Id: ed25519:&lt;pubkey&gt;</code> — worker public key identifier</li><li><code>Attest-Program: blake3:&lt;hex&gt;</code> — hash of runner binary or WASM module (RECOMMENDED)</li><li><code>Attest-Sig: ed25519:&lt;sig&gt;</code> — signature over the attestation envelope (OPTIONAL)</li></ul><p>Example (trailers):</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Job-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Worker-Id: ed25519:&lt;pubkey&gt;</span></span>
<span class="line"><span>Proof-Of-Execution: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Attest-Program: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Attest-Sig: ed25519:&lt;sig&gt;</span></span></code></pre></div><p>See ADR-0002 for the normative PoE requirements and ADR-0001 for the definition of <code>content_id</code> and canonical serialization.</p><hr><h2 id="_20-consensus-governance-normative" tabindex="-1">20. Consensus Governance (Normative) <a class="header-anchor" href="#_20-consensus-governance-normative" aria-label="Permalink to &quot;20. Consensus Governance (Normative)&quot;">​</a></h2><p><a id="20"></a><a id="20-consensus-governance-normative"></a></p><p><a id="20-consensus-governance-normative"></a><a id="20.-consensus-governance-normative"></a> See also: <a href="./decisions/ADR-0003/DECISION.html">ADR-0003</a>.</p><p>Governs gated actions via proposals, approvals, and grants. Governance artifacts are Git commits under dedicated refs (see on-disk layout). All trailers MUST use canonical, prefixed encodings (<code>blake3:&lt;hex&gt;</code>, <code>ed25519:&lt;pubkey&gt;</code>).</p><h3 id="_20-1-workflow" tabindex="-1">20.1 Workflow <a class="header-anchor" href="#_20-1-workflow" aria-label="Permalink to &quot;20.1 Workflow&quot;">​</a></h3><p><a id="20.1"></a><a id="201-workflow"></a></p><p><a id="20.1"></a><a id="201-workflow"></a><a id="20.1-workflow"></a><a id="201"></a> Proposal → Approvals (N-of-M) → Grant. Quorum groups (e.g., <code>@leads</code>) MUST be defined in the trust graph (<code>gatos/trust/graph.json</code>).</p><h3 id="_20-2-commit-structures-trailers" tabindex="-1">20.2 Commit Structures (Trailers) <a class="header-anchor" href="#_20-2-commit-structures-trailers" aria-label="Permalink to &quot;20.2 Commit Structures (Trailers)&quot;">​</a></h3><p><a id="20.2"></a><a id="202-commit-structures-trailers"></a></p><p><a id="20.2"></a><a id="202-commit-structures-trailers"></a><a id="20.2-commit-structures-trailers"></a><a id="202"></a></p><ul><li><p>Proposal (at <code>refs/gatos/proposals/…</code>):</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Action: &lt;string&gt;</span></span>
<span class="line"><span>Target: &lt;uri&gt;</span></span>
<span class="line"><span>Proposal-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Required-Quorum: &lt;expr&gt;</span></span>
<span class="line"><span>Expire-At: &lt;ISO8601&gt;</span></span>
<span class="line"><span>Policy-Rule: &lt;policy id&gt;</span></span>
<span class="line"><span>Created-By: &lt;actor&gt;</span></span></code></pre></div><p>(Note: <code>gatos://</code> is the canonical URI scheme for addressing resources managed within the GATOS operating surface.)</p></li><li><p>Approval (at <code>refs/gatos/approvals/…</code>):</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Proposal-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Approval-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Signer: ed25519:&lt;pubkey&gt;</span></span>
<span class="line"><span>Expires-At: &lt;ISO8601&gt;   # OPTIONAL</span></span></code></pre></div></li><li><p>Grant (at <code>refs/gatos/grants/…</code>):</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Proposal-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Grant-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Proof-Of-Consensus: blake3:&lt;hex&gt;</span></span></code></pre></div></li></ul><h3 id="_20-3-proof-of-consensus-poc" tabindex="-1">20.3 Proof-Of-Consensus (PoC) <a class="header-anchor" href="#_20-3-proof-of-consensus-poc" aria-label="Permalink to &quot;20.3 Proof-Of-Consensus (PoC)&quot;">​</a></h3><p><a id="20.3"></a><a id="203-proof-of-consensus-poc"></a></p><p><a id="20.3"></a><a id="203-proof-of-consensus-poc"></a><a id="20.3-proof-of-consensus-poc"></a><a id="203"></a><a id="20.3-proofofconsensus-poc"></a><code>Proof-Of-Consensus</code> is the BLAKE3 of a canonical JSON envelope containing:</p><ul><li>The canonical proposal envelope (by value or <code>Proposal-Id</code>).</li><li>A sorted list (by <code>Signer</code>) of all valid approvals used to reach quorum (by value or <code>Approval-Id</code>).</li><li>The governance rule id (<code>Policy-Rule</code>) and effective quorum parameters.</li></ul><p>PoC envelope SHOULD be stored canonically under <code>refs/gatos/audit/proofs/governance/&lt;proposal-id&gt;</code>; the Grant’s <code>Proof-Of-Consensus</code> trailer MUST equal <code>blake3(envelope_bytes)</code>.</p><h3 id="_20-4-lifecycle-states" tabindex="-1">20.4 Lifecycle States <a class="header-anchor" href="#_20-4-lifecycle-states" aria-label="Permalink to &quot;20.4 Lifecycle States&quot;">​</a></h3><p><a id="20.4"></a><a id="204-lifecycle-states"></a></p><p><a id="20.4"></a><a id="204-lifecycle-states"></a><a id="20.4-lifecycle-states"></a><a id="204"></a></p><table tabindex="0"><thead><tr><th style="text-align:left;">State</th><th style="text-align:left;">Meaning</th></tr></thead><tbody><tr><td style="text-align:left;">proposal</td><td style="text-align:left;">Awaiting votes</td></tr><tr><td style="text-align:left;">partial</td><td style="text-align:left;">Some approvals collected</td></tr><tr><td style="text-align:left;">granted</td><td style="text-align:left;">Quorum reached; action allowed</td></tr><tr><td style="text-align:left;">expired</td><td style="text-align:left;">Proposal timed out</td></tr><tr><td style="text-align:left;">revoked</td><td style="text-align:left;">Grant withdrawn or superseded</td></tr></tbody></table><figure><img src="`+C+`" alt="diagram 21" loading="lazy"></figure><h3 id="_20-5-revocation" tabindex="-1">20.5 Revocation <a class="header-anchor" href="#_20-5-revocation" aria-label="Permalink to &quot;20.5 Revocation&quot;">​</a></h3><p><a id="20.5"></a><a id="205-revocation"></a></p><p><a id="20.5"></a><a id="205-revocation"></a><a id="20.5-revocation"></a><a id="205"></a> A grant MAY be revoked by creating a <code>revocation</code> commit under <code>refs/gatos/revocations/</code> with trailers:</p><div class="language-text vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">text</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span>Grant-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Revocation-Id: blake3:&lt;hex&gt;</span></span>
<span class="line"><span>Reason: &lt;free-text&gt;</span></span>
<span class="line"><span>Revoked-By: &lt;actor&gt;</span></span></code></pre></div><h3 id="_20-6-bus-topics-recommended" tabindex="-1">20.6 Bus Topics (recommended) <a class="header-anchor" href="#_20-6-bus-topics-recommended" aria-label="Permalink to &quot;20.6 Bus Topics (recommended)&quot;">​</a></h3><p><a id="20.6"></a><a id="206-bus-topics-recommended"></a></p><p><a id="20.6"></a><a id="206-bus-topics-recommended"></a><a id="20.6-bus-topics-recommended"></a><a id="206"></a><code>gatos.governance.proposal.created</code>, <code>gatos.governance.approval.created</code>, <code>gatos.governance.grant.created</code>, <code>gatos.governance.grant.revoked</code>.</p><hr><h2 id="glossary" tabindex="-1">Glossary <a class="header-anchor" href="#glossary" aria-label="Permalink to &quot;Glossary&quot;">​</a></h2><p><a id="glossary"></a></p><p><a id="glossary"></a></p><ul><li>PoF — Proof-of-Fold. Evidence that a state root was derived deterministically from a specific ledger window under a specific fold/policy root.</li><li>PoE — Proof-of-Execution. Signed attestation that a worker executed a job (who/what/where/inputs/outputs).</li><li>PoC — Proof-of-Consensus. Evidence that a governance action met its quorum/approval rules.</li><li>PoX — Proof-of-Experiment. Bundle tying inputs → program → outputs for scientific reproducibility.</li><li>ULID — Lexicographically sortable identifier used as an idempotency key for messages.</li></ul>`,257)])])}const R=a(q,[["render",w]]);export{L as __pageData,R as default};
